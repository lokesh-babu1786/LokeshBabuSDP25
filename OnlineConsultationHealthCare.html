<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Online Medical Consultation</title>
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#fff;
      --muted:#6b7280;
      --accent:#2563eb;
      --radius:12px;
      --header-bg:#2563eb;
      --header-color:#fff;
      --footer-bg:#1f2937;
      --footer-color:#fff;
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --card:#0f1724;
      --muted:#9ca3af;
      --accent:#60a5fa;
      --header-bg:#1e293b;
      --header-color:#60a5fa;
      --footer-bg:#111827;
      --footer-color:#9ca3af;
    }
    *{box-sizing:border-box}
    body{
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      margin:0; background:var(--bg); color:var(--muted);
    }
    .header-full{
      width:100%;padding:16px;background:var(--header-bg);color:var(--header-color);
      text-align:center;font-size:22px;font-weight:bold;margin-bottom:20px;
    }
    .container{max-width:1100px;margin:28px auto;padding:20px}
    h1,h2{margin:0;color:var(--muted)}
    h1{font-size:24px}
    h2{font-size:18px;margin-bottom:8px}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .video-area{display:flex;flex-direction:column;gap:12px}
    video{width:100%;height:300px;background:#000;border-radius:10px;object-fit:cover}
    .video-actions{display:flex;gap:8px;margin-bottom:12px}
    .form-group{display:flex;flex-direction:column;margin-bottom:10px}
    label{font-size:13px;color:var(--muted);margin-bottom:6px}
    input,textarea,select{padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    textarea{min-height:90px}
    .right-col{display:flex;flex-direction:column;gap:12px}
    .chat{height:320px;display:flex;flex-direction:column;border-radius:10px;overflow:hidden}
    .messages{flex:1;padding:12px;overflow:auto;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent)}
    .msg{margin-bottom:10px;max-width:80%;padding:8px 10px;border-radius:10px;font-size:13px}
    .msg.you{background:#e6f0ff;color:#05307a;margin-left:auto}
    .msg.them{background:#f0f4f8;color:#0b2350}
    .chat-input{display:flex;gap:8px;padding:8px;border-top:1px solid #e6e9ef}
    .small{font-size:12px;color:var(--muted)}
    .login-card, .register-card{max-width:400px;margin:60px auto;padding:20px;background:var(--card);border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.06);}
    .login-card input, .register-card input{margin-bottom:10px;width:100%;}
    .login-card button, .register-card button{width:100%;}
    footer{background:var(--footer-bg);color:var(--footer-color);padding:12px;text-align:center}
    @media (max-width:980px){.grid{grid-template-columns:1fr}video{height:220px}}
  </style>
</head>
<body>
  <div class="header-full">Online Medical Consultation</div>

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-card">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <div class="form-group">
      <label for="captchaInput">Enter Captcha: <span id="captchaText"></span></label>
      <input type="text" id="captchaInput" placeholder="Type Captcha Here" required>
    </div>
    <button class="btn" id="loginBtn">Login</button>
    <div class="small" id="loginError" style="color:red;margin-top:6px;"></div>
    <div class="small" style="margin-top:6px;">Don't have account? <a href="#" id="showRegister">Register here</a></div>
  </div>

  <!-- REGISTRATION PAGE -->
  <div id="registerPage" class="register-card" style="display:none;">
    <h2>Register</h2>
    <input type="text" id="regName" placeholder="Full Name" required>
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPassword" placeholder="Password (Min 6 chars, 1 number, 1 special)" required>
    <input type="password" id="regConfirm" placeholder="Confirm Password" required>
    <button class="btn" id="registerBtn">Register</button>
    <div class="small" id="registerError" style="color:red;margin-top:6px;"></div>
    <div class="small" style="margin-top:6px;">Already have account? <a href="#" id="showLogin">Login here</a></div>
  </div>

  <!-- MAIN APP PAGE -->
  <div class="container" id="app" style="display:none;">
    <header>
      <h1>Online Consultation — Medical</h1>
      <div class="controls">
        <div class="small" id="status">Status: idle</div>
        <button class="btn" id="themeToggle">Toggle theme</button>
        <button class="btn" id="logoutBtn">Logout</button>
      </div>
    </header>

    <main class="grid">
      <!-- VIDEO AND BOOKING -->
      <section class="card">
        <h2>Live Video Consultation</h2>
        <div class="video-area">
          <video id="localVideo" playsinline autoplay muted></video>
          <div class="video-actions">
            <button class="btn" id="startCam">Start Camera</button>
            <button class="btn" id="stopCam">Stop Camera</button>
            <button class="btn" id="shareScreen">Share Screen</button>
          </div>

          <h2>Booking Form</h2>
          <form id="bookingForm">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div class="form-group"><label for="name">Full Name</label><input id="name" required></div>
              <div class="form-group"><label for="email">Email</label><input id="email" type="email" required></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div class="form-group"><label for="phone">Phone</label><input id="phone" type="tel"></div>
              <div class="form-group"><label for="type">Consultation Type</label>
                <select id="type"><option>General</option><option>Technical</option><option>Legal</option><option>Medical</option></select>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div class="form-group"><label for="date">Preferred Date</label><input id="date" type="date"></div>
              <div class="form-group"><label for="time">Preferred Time</label><input id="time" type="time"></div>
            </div>
            <div class="form-group"><label for="note">Short Note / Reason</label><textarea id="note"></textarea></div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn" type="submit">Request Consultation</button>
              <div class="small" id="bookingResult" aria-live="polite"></div>
            </div>
          </form>
        </div>
      </section>

      <!-- CHAT AND ACTIONS -->
      <aside class="right-col">
        <div class="card chat" aria-label="Consultation chat">
          <h2>Consultation Chat</h2>
          <div class="messages" id="messages">
            <div class="msg them">Welcome! Please enter your details and start the camera.</div>
          </div>
          <div class="chat-input">
            <input id="chatText" placeholder="Type a message" style="flex:1;border-radius:8px;padding:8px;border:1px solid #e6e9ef" />
            <button class="btn" id="sendMsg">Send</button>
          </div>
        </div>

        <div class="card">
          <h2>Quick Actions</h2>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
            <button class="btn" id="simulateAccept">Simulate Accept</button>
            <button class="btn" id="simulateReject">Simulate Reject</button>
            <button class="btn" id="downloadSummary">Download Summary</button>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      Frontend demo only. Real consultations require a server and signaling service.
    </footer>
  </div>

  <script>
    // CAPTCHA
    function generateCaptcha(){
      const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let text=''; for(let i=0;i<5;i++) text+=chars.charAt(Math.floor(Math.random()*chars.length));
      document.getElementById('captchaText').textContent=text;
      return text;
    }
    let currentCaptcha=generateCaptcha();

    // Show/Hide Pages
    const loginPage=document.getElementById('loginPage');
    const registerPage=document.getElementById('registerPage');
    const appPage=document.getElementById('app');
    document.getElementById('showRegister').addEventListener('click',(e)=>{ e.preventDefault(); loginPage.style.display='none'; registerPage.style.display='block';});
    document.getElementById('showLogin').addEventListener('click',(e)=>{ e.preventDefault(); registerPage.style.display='none'; loginPage.style.display='block';});

    // Login
    const loginBtn=document.getElementById('loginBtn');
    const loginError=document.getElementById('loginError');
    loginBtn.addEventListener('click', ()=>{
      const email=document.getElementById('loginEmail').value.trim();
      const password=document.getElementById('loginPassword').value.trim();
      const captchaInput=document.getElementById('captchaInput').value.trim().toUpperCase();
      if(!email || !password){ loginError.textContent='Enter email & password'; return;}
      if(captchaInput!==currentCaptcha){ loginError.textContent='Captcha mismatch'; currentCaptcha=generateCaptcha(); return;}
      localStorage.setItem('user', JSON.stringify({email,password}));
      loginError.textContent=''; loginPage.style.display='none'; appPage.style.display='block';
    });

    // Registration
    const registerBtn=document.getElementById('registerBtn');
    const registerError=document.getElementById('registerError');
    registerBtn.addEventListener('click',()=>{
      const name=document.getElementById('regName').value.trim();
      const email=document.getElementById('regEmail').value.trim();
      const password=document.getElementById('regPassword').value;
      const confirm=document.getElementById('regConfirm').value;
      const pwdRegex=/^(?=.*[0-9])(?=.*[!@#$%^&])[A-Za-z0-9!@#$%^&]{6,}$/;
      if(!name||!email||!password||!confirm){ registerError.textContent='All fields required'; return;}
      if(password!==confirm){ registerError.textContent='Passwords do not match'; return;}
      if(!pwdRegex.test(password)){ registerError.textContent='Password must be 6+ chars, 1 number & 1 special'; return;}
      localStorage.setItem('user', JSON.stringify({email,password,name}));
      registerError.style.color='green'; registerError.textContent='Registered! Redirecting to login...';
      setTimeout(()=>{ registerPage.style.display='none'; loginPage.style.display='block'; },1500);
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('user'); loginPage.style.display='block'; appPage.style.display='none';
    });

    // Theme toggle
    const themeToggle=document.getElementById('themeToggle');
    themeToggle.addEventListener('click', ()=>{ const cur=document.documentElement.getAttribute('data-theme'); document.documentElement.setAttribute('data-theme',cur==='dark'?'':'dark'); });

    // Auto-login if user exists
    if(localStorage.getItem('user')){ loginPage.style.display='none'; appPage.style.display='block'; }

    // Video / Camera
    const startCam=document.getElementById('startCam');
    const stopCam=document.getElementById('stopCam');
    const shareScreen=document.getElementById('shareScreen');
    const localVideo=document.getElementById('localVideo');
    const statusEl=document.getElementById('status');
    let stream=null;
    async function startCamera(){ try{ stream=await navigator.mediaDevices.getUserMedia({video:{width:1280}, audio:true}); localVideo.srcObject=stream; statusEl.textContent='Status: camera on'; } catch(e){ alert('Camera access denied: '+e.message); statusEl.textContent='Status: camera error';} }
    function stopCamera(){ if(stream){stream.getTracks().forEach(t=>t.stop()); localVideo.srcObject=null; stream=null; statusEl.textContent='Status: idle';} }
    startCam.addEventListener('click', startCamera);
    stopCam.addEventListener('click', stopCamera);
    shareScreen.addEventListener('click', async ()=>{ try{ const s=await navigator.mediaDevices.getDisplayMedia({video:true}); localVideo.srcObject=s; statusEl.textContent='Status: screen shared'; s.getVideoTracks()[0].addEventListener('ended',()=>{localVideo.srcObject=null; statusEl.textContent='Status: idle';}); } catch(e){ alert('Screen share not available: '+e.message);} });

    // Booking form & chat
    const bookingForm=document.getElementById('bookingForm');
    const bookingResult=document.getElementById('bookingResult');
    bookingForm.addEventListener('submit',(e)=>{
      e.preventDefault();
      const data={name:document.getElementById('name').value.trim(),email:document.getElementById('email').value.trim(),type:document.getElementById('type').value,date:document.getElementById('date').value,time:document.getElementById('time').value,note:document.getElementById('note').value.trim()};
      if(!data.name||!data.email){ bookingResult.textContent='Please provide name and email.'; return;}
      bookingResult.textContent='Request sent — awaiting confirmation (demo).';
      addMessage('you', `Requested ${data.type} consultation on ${data.date||'any date'} at ${data.time||'any time'} — ${data.note||''}`);
    });

    const messages=document.getElementById('messages');
    const chatText=document.getElementById('chatText');
    const sendMsg=document.getElementById('sendMsg');
    function addMessage(who,text){ const d=document.createElement('div'); d.className='msg '+(who==='you'?'you':'them'); d.textContent=text; messages.appendChild(d); messages.scrollTop=messages.scrollHeight;}
    sendMsg.addEventListener('click',()=>{ const t=chatText.value.trim(); if(!t)return; addMessage('you',t); chatText.value=''; setTimeout(()=>addMessage('them','Agent: Thanks, we received your message — an agent will join shortly.'),700);});
    chatText.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMsg.click(); } });

    document.getElementById('simulateAccept').addEventListener('click',()=>addMessage('them','Agent: Your consultation is accepted. Please join the call.'));
    document.getElementById('simulateReject').addEventListener('click',()=>addMessage('them','Agent: Sorry, no slots available. Please choose another date.'));

    // Download Summary Completion
    document.getElementById('downloadSummary').addEventListener('click',()=>{
      const name=document.getElementById('name').value||'Anonymous';
      const email=document.getElementById('email').value||'';
      let chatTexts=Array.from(messages.querySelectorAll('.msg')).map(n=>n.textContent).join('\n');
      const content = `Consultation Summary
Name: ${name}
Email: ${email}

Chat:
${chatTexts}`;
      const blob=new Blob([content],{type:'text/plain'});
      const url=URL.createObjectURL(blob); 
      const a=document.createElement('a'); 
      a.href=url; 
      a.download="consultation-summary.txt";
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
